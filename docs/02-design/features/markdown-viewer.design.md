# Design: Markdown Viewer

> 터미널에서 마크다운 문서를 렌더링하는 `/view` 스킬

## 참조 문서
- Plan: `docs/01-plan/features/markdown-viewer.plan.md`

---

## 1. 스킬 구조

### 파일 위치
```
.claude/skills/
└── view/
    └── SKILL.md
```

### 스킬 메타데이터
```yaml
---
name: view
description: 마크다운 문서를 터미널에서 보기 좋게 렌더링
---
```

---

## 2. 명령어 인터페이스

| 명령어 | 설명 | 예시 |
|--------|------|------|
| `/view <path>` | 파일 렌더링 | `/view docs/report.md` |
| `/view --last` | 마지막 생성 문서 | `/view --last` |
| `/view --list` | 최근 문서 목록 | `/view --list` |
| `/view <path> --tool <name>` | 특정 도구 사용 | `/view README.md --tool bat` |

---

## 3. 실행 흐름

### 3.1 기본 뷰어 (`/view <path>`)

```
┌─────────────────────────────────────────────────────────┐
│ Step 1: 인자 파싱                                        │
│   - path 추출                                           │
│   - --tool 옵션 확인                                     │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Step 2: 파일 존재 확인                                   │
│   - 절대 경로 변환                                       │
│   - 파일 존재 여부 체크                                   │
│   - .md 확장자 확인 (경고만, 차단 안함)                    │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Step 3: 렌더링 도구 선택                                 │
│   Priority: glow > bat > mdcat > cat                    │
│   - --tool 지정 시 해당 도구 사용                         │
│   - 미지정 시 자동 감지                                   │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Step 4: 렌더링 실행                                      │
│   - 선택된 도구로 파일 출력                               │
│   - 긴 문서는 페이저 사용 (less)                          │
└─────────────────────────────────────────────────────────┘
```

### 3.2 마지막 문서 (`/view --last`)

```
┌─────────────────────────────────────────────────────────┐
│ Step 1: 최근 .md 파일 찾기                               │
│   find . -name "*.md" -type f -mmin -60 | head -1       │
│   (최근 60분 내 수정된 파일)                              │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Step 2: 파일 경로 출력 후 렌더링                          │
│   "Opening: docs/report.md"                             │
└─────────────────────────────────────────────────────────┘
```

### 3.3 문서 목록 (`/view --list`)

```
┌─────────────────────────────────────────────────────────┐
│ Step 1: 최근 .md 파일 목록 조회                          │
│   find . -name "*.md" -type f -mtime -7                 │
│   | xargs ls -lt | head -10                             │
└─────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────┐
│ Step 2: 테이블 형식 출력                                 │
│   | # | 파일 | 수정일 |                                  │
│   |---|------|--------|                                  │
│   | 1 | docs/report.md | 2분 전 |                       │
└─────────────────────────────────────────────────────────┘
```

---

## 4. 새 터미널 창에서 실행

### 핵심 변경사항
- Claude Code 내에서 출력하지 않고 **새 터미널 창**을 열어서 glow 실행
- macOS의 osascript를 사용하여 Terminal.app 또는 iTerm2 제어

### 터미널 앱 감지
```bash
if [[ -d "/Applications/iTerm.app" ]]; then
  # iTerm2 사용
else
  # Terminal.app 사용
fi
```

### 실행 스크립트

**Terminal.app:**
```bash
osascript -e "tell application \"Terminal\"
  activate
  do script \"glow -p '$FILE_PATH'\"
end tell"
```

**iTerm2:**
```bash
osascript -e "tell application \"iTerm\"
  activate
  create window with default profile
  tell current session of current window
    write text \"glow -p '$FILE_PATH'\"
  end tell
end tell"
```

---

## 5. 출력 형식

### 성공 시
```
📄 docs/01-plan/features/markdown-viewer.plan.md
────────────────────────────────────────────────
[렌더링된 마크다운 내용]
────────────────────────────────────────────────
Tool: glow | Lines: 112
```

### 파일 없음
```
❌ 파일을 찾을 수 없습니다: docs/missing.md
```

### 도구 미설치 안내 (cat 사용 시)
```
💡 더 나은 렌더링을 위해 glow 설치를 권장합니다:
   brew install glow
```

---

## 6. 에러 처리

| 상황 | 처리 |
|------|------|
| 파일 없음 | 에러 메시지 출력 |
| 권한 없음 | 에러 메시지 출력 |
| 바이너리 파일 | 경고 후 중단 |
| 도구 미설치 | cat으로 fallback + 안내 |

---

## 7. 구현 체크리스트

### MVP
- [ ] SKILL.md 파일 생성
- [ ] 기본 뷰어 로직 (파일 경로 → 렌더링)
- [ ] 도구 자동 감지 (glow > bat > cat)
- [ ] 에러 처리

### 추가 기능
- [ ] `--last` 옵션
- [ ] `--list` 옵션
- [ ] `--tool` 옵션

---

## 8. 테스트 시나리오

| 시나리오 | 입력 | 예상 결과 |
|----------|------|-----------|
| 기본 뷰어 | `/view README.md` | 파일 렌더링 |
| 절대 경로 | `/view /Users/.../file.md` | 파일 렌더링 |
| 상대 경로 | `/view ./docs/plan.md` | 파일 렌더링 |
| 파일 없음 | `/view missing.md` | 에러 메시지 |
| 마지막 문서 | `/view --last` | 최근 파일 렌더링 |
| 목록 | `/view --list` | 테이블 출력 |

---

## 9. 향후 확장 가능성

- 브라우저 프리뷰 (`--browser` 옵션)
- PDF 변환 (`--pdf` 옵션)
- HTML 변환 (`--html` 옵션)

---

생성일: 2026-02-03
상태: Ready for Implementation
